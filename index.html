<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>Resurgence Map Calculator</title>
    <style>
        html,body { margin:0; padding:0; height:100%; width:100%; box-sizing:border-box; }
        body {
            display:flex;
            flex-direction:column;
            height:100vh; width:100vw;
            background:#1a1a1a; color:#fff; font-family:sans-serif; overflow:hidden;
        }
        #topbar {
            background:none;
            color:#fff;
            display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
            gap:0px;
            border:none;
            min-height:0;
            height:auto;
            width:100vw;
            box-sizing:border-box;
            z-index:30;
            position:relative;
            padding:50px 0 30px 0;
            pointer-events:none;
        }
        .mini-title {
            font-size:clamp(2.1rem, 8vw, 4.2rem);
            color:#6AD44C;
            letter-spacing:3px;
            font-weight:900;
            text-transform:uppercase;
            user-select:none;
            opacity:.98;
            line-height:1;
            margin-bottom:0.3em;
            margin-top:0.25em;
            text-shadow: 0 4px 24px #080, 0 1px 0px #222, 0 0px 18px #0007;
        }
        .sub-title {
            font-size:clamp(1.1rem, 4vw, 2.2rem);
            color:#ccc;
            text-shadow: 0 2px 8px #333;
            font-weight:bold;
            margin:0 0 0.6em 0;
            line-height:1.1;
            text-align:center;
            letter-spacing:2px;
        }

        /* ==== ACTION ICON OVERLAY ==== */
        #action-overlay {
            position:fixed;
            left:clamp(2px, 5vw, 32px);
            bottom:clamp(2px, 5vw, 32px);
            z-index:50;
            display:flex;
            flex-direction:row;
            gap:clamp(2px, 6vw, 32px);
            align-items:center;
            background:rgba(24,32,28,0.60);
            border-radius:20px;
            box-shadow:0 8px 30px #0006, 0 2px 6px #6ad44c22;
            padding:clamp(4px, 3vw, 18px) clamp(4px, 3vw, 20px) clamp(3px, 2.5vw, 16px) clamp(4px, 3vw, 22px);
            border:2px solid #353;
            pointer-events:auto;
            transition:background 0.14s;
        }
        .ctrl-ico {
            width:clamp(28px, 12vw, 72px); 
            height:clamp(28px, 12vw, 72px); 
            min-width:clamp(28px, 12vw, 72px); 
            min-height:clamp(28px, 12vw, 72px);
            border:none; outline:none; border-radius:50%;
            cursor:pointer;
            display:flex; align-items:center; justify-content:center;
            background:#252525;
            transition:background .13s, box-shadow .13s, transform .11s;
            font-size:clamp(0.7rem, 4vw, 2.4rem);
            margin:0 0;
            box-sizing:border-box;
            box-shadow:0 4px 18px #0004,0 1.5px 0 #0909 inset;
        }
        .ctrl-ico:hover, .ctrl-ico:active { background:#363; box-shadow:0 6px 22px #161b; transform:scale(1.06);}
        .ctrl-ico[data-color="gold"] { background:#4e4010; color:#ffe700;}
        .ctrl-ico[data-color="gold"]:hover { background:#806610; }
        .ctrl-ico[data-color="green"] { background:#2b4d24; color:#6AD44C;}
        .ctrl-ico[data-color="green"]:hover { background:#377b2d;}
        .ctrl-ico[data-color="blue"] { background:#273651; color:#7bdfff;}
        .ctrl-ico[data-color="blue"]:hover { background:#304d80;}
        .ctrl-ico[data-color="gray"] { background:#444; color:#fff;}
        .ctrl-ico[data-color="gray"]:hover { background:#666!important;}
        #cal-info {
            font-size:clamp(0.82rem, 2.2vw, 1.1rem);
            padding:4px 10px;
            background:#000a; color:#6AD44C;
            border-radius:8px;
            min-height:32px; max-width:68px; box-sizing:border-box;
            text-align:center;
            border:1.7px solid #3b403a;
            margin-left:16px;
            margin-right:0;
            margin-top:0;
            line-height:1.25;
            font-family:'Courier New',Courier,monospace;
            overflow:hidden;
            white-space:nowrap;
        }
        /* Remove previous forced downscaling at certain breakpoints (handled above with clamp) */
        /* Responsive font-size, button and overlay sizing is now handled by clamp() above! */

        #map-viewport { flex-grow:1; overflow:hidden; background:#000; position:relative; touch-action:none;}
        canvas { display:block; touch-action:none;}
    </style>
</head>
<body>
<div id="topbar">
    <div class="mini-title">RMC TO GO</div>
    <div class="sub-title">Made By Phoxphor</div>
</div>
<div id="map-viewport">
    <canvas id="mapCanvas"></canvas>
    <div id="action-overlay">
        <button class="ctrl-ico" title="Add Airdrop" data-color="gold" onclick="addAirdrop()">&#x1F4E6;</button>
        <button class="ctrl-ico" title="Find Nearest" data-color="green" onclick="findNearest()">&#x1F50E;</button>
        <button class="ctrl-ico" title="Toggle Icons" data-color="gray" onclick="toggleVisibility()">&#x1F5FA;</button>
        <button class="ctrl-ico" title="Reset Map" data-color="blue" onclick="resetMap()">&#x21BB;</button>
    </div>
</div>
<script src="index.js"></script>
<script>
// --- Ensure default centering on load ---
window.addEventListener("DOMContentLoaded",()=> {
    if(typeof centerToZeroZero==="function") { centerToZeroZero(); }
    else {
        if(window.mapImg&&mapImg.width) { 
            setMapViewToZeroZero();
        } 
        else {
            // fallback: check again after map loads
            let img=document.querySelector('img,canvas');
            img&&img.addEventListener('load',setMapViewToZeroZero,{once:true});
        }
    }
});
// Helper for centering to (0,0) - tries to work with main var/view logic
function setMapViewToZeroZero(smooth=0){
    try{
        let canvas=document.getElementById('mapCanvas');
        let map=window.mapImg;
        if(!map||!canvas) return;
        let v=window.targetView||window.view;
        let zmin=(window.MIN_ZOOM)||0.8;
        let zmax=(window.MAX_ZOOM)||2;
        let zoom=window.targetView && window.targetView.zoom || zmin;
        let cx=canvas.width/2,cy=canvas.height/2;
        let mx=map.width/2,my=map.height/2;
        let zx=zoom;
        let x=cx-mx*zx,y=cy-my*zx;

        function updateView(_x,_y,_z) {
            if(window.targetView) { targetView.x=_x;targetView.y=_y;targetView.zoom=_z;}
            if(window.view) { view.x=_x;view.y=_y;view.zoom=_z;}
            if(typeof clampView==="function")clampView();
            if(typeof render==="function")render();
        }
        if(smooth>0 && window.targetView){
            let steps=14,cur=0,_x=v.x,_y=v.y,_z=v.zoom;
            let dx=(x-_x)/steps,dy=(y-_y)/steps,dz=(zoom-_z)/steps;
            let anim=()=>{ if(cur<steps){_x+=dx;_y+=dy;_z+=dz;updateView(_x,_y,_z);cur++;setTimeout(anim,12);}else{updateView(x,y,zoom);} };
            anim();
        }else{
            updateView(x,y,zoom);
        }
    }catch(e){}
}
// Expose for index.js usage or fallback
window.centerToZeroZero=()=>setMapViewToZeroZero(0);
</script>
</body>
</html>
