<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>Resurgence Map Calculator</title>
    <style>
        html,body{margin:0;padding:0;height:100%;width:100%;box-sizing:border-box;}
        body {
            display:flex;
            flex-direction:column;
            height:100vh;width:100vw;
            background:#1a1a1a;
            color:#fff;
            font-family:sans-serif;
            overflow:hidden;
        }
        #sidebar {
            width:100vw;
            background:#252525;
            padding:12px 8px 10px 8px;
            display:flex;
            flex-direction:column;
            align-items:center;
            gap:12px;
            border-bottom:1px solid #444;
            z-index:10;
            box-sizing:border-box;
        }
        @media(min-width:750px){
            body{flex-direction:row;}
            #sidebar{
                width:280px;
                min-width:280px;
                height:100vh;
                border-bottom:none;
                border-right:1px solid #444;
                align-items:center;
                padding:20px;
                gap:18px;
            }
        }
        h2{margin:0;font-size:2.05rem;color:#6AD44C;text-transform:uppercase;letter-spacing:2px;line-height:1;text-align:center;}
        @media(min-width:750px){h2{font-size:2.5rem;}}
        .author{font-size:0.75rem;color:#888;margin-bottom:8px;font-weight:bold;text-align:center;width:100%;}
        @media(max-width:750px){.author{display:none;}}
        .button-group{width:100%;display:flex;flex-direction:column;align-items:center;gap:9px;}
        .control-btn{
            padding:11px 6px;
            cursor:pointer;
            background:#444;
            color:#fff;
            border:none;
            border-radius:6px;
            font-weight:bold;
            width:95%;max-width:220px;text-transform:uppercase;
            font-size:1.09rem;
            margin:0 auto;
            display:block;
        }
        .control-btn:hover,.control-btn:active{background:#555;}
        #cal-info{
            font-size:0.86rem;padding:12px 6px;background:#000;color:#6AD44C;
            border-radius:6px;min-height:120px;border:1px solid #6AD44C;
            display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;overflow-y:auto;
            line-height:1.6;font-family:'Courier New',Courier,monospace;
            box-shadow:inset 0 0 10px rgba(106,212,76,0.18);
            width:100%;max-width:245px;margin:0 auto;
        }
        hr{border:0;border-top:1px solid #444;margin:5px 0;width:80%;}
        .obj-list{width:100%;display:flex;flex-direction:column;gap:8px;margin-top:10px;}
        .obj-btn{background:none;border:none;padding:4px;cursor:pointer;text-decoration:underline;text-transform:uppercase;font-weight:bold;font-family:'Courier New',Courier,monospace;font-size:0.9rem;transition:transform .1s;}
        .obj-btn:hover{transform:scale(1.1);filter:brightness(1.3);}
        #map-viewport{flex-grow:1;overflow:hidden;background:#000;position:relative;touch-action:none;}
        canvas{display:block;touch-action:none;}
        @media (max-width:750px){
            #sidebar{gap:14px;font-size:1em;width:100vw;min-width:unset;box-sizing:border-box;}
            #cal-info{font-size:0.97em;width:100%;max-width:295px;margin-bottom:0;}
            .button-group{gap:10px;}
            .control-btn{font-size:1em;min-width:120px;max-width:310px;width:92vw;}
            hr{width:90%;margin:6px auto;}
        }
    </style>
</head>
<body>
<div id="sidebar">
    <h2>RMC To Go</h2>
    <div class="author">Made By Phoxphor</div>
    <div class="button-group">
        <button class="control-btn" style="background:#4e4010;color:#ffff00;" onclick="addAirdrop()">Add Airdrop</button>
        <button class="control-btn" style="background:#2b4d24;color:#6AD44C;" onclick="findNearest()">Find Nearest</button>
        <button class="control-btn" onclick="toggleVisibility()">Toggle Icons</button>
        <button class="control-btn" style="background:#273651;color:#7bdfff;" onclick="resetMap()">Reset</button>
    </div>
    <hr>
    <div id="cal-info">WAITING FOR INPUT...</div>
    <hr>
</div>
<div id="map-viewport">
    <canvas id="mapCanvas"></canvas>
</div>
<script src="index.js"></script>
<script>
// --- Ensure default centering on load ---
window.addEventListener("DOMContentLoaded",()=> {
    if(typeof centerToZeroZero==="function") { centerToZeroZero(); }
    else {
        if(window.mapImg&&mapImg.width) { 
            setMapViewToZeroZero();
        } 
        else {
            // fallback: check again after map loads
            let img=document.querySelector('img,canvas');
            img&&img.addEventListener('load',setMapViewToZeroZero,{once:true});
        }
    }
});
// Helper for centering to (0,0) - tries to work with main var/view logic
function setMapViewToZeroZero(smooth=0){
    try{
        let canvas=document.getElementById('mapCanvas');
        let map=window.mapImg;
        if(!map||!canvas) return;
        let v=window.targetView||window.view;
        let zmin=(window.MIN_ZOOM)||0.8;
        let zmax=(window.MAX_ZOOM)||2;
        let zoom=window.targetView && window.targetView.zoom || zmin;
        let cx=canvas.width/2,cy=canvas.height/2;
        let mx=map.width/2,my=map.height/2;
        let zx=zoom;
        let x=cx-mx*zx,y=cy-my*zx;

        function updateView(_x,_y,_z) {
            if(window.targetView) { targetView.x=_x;targetView.y=_y;targetView.zoom=_z;}
            if(window.view) { view.x=_x;view.y=_y;view.zoom=_z;}
            if(typeof clampView==="function")clampView();
            if(typeof render==="function")render();
        }
        if(smooth>0 && window.targetView){
            let steps=14,cur=0,_x=v.x,_y=v.y,_z=v.zoom;
            let dx=(x-_x)/steps,dy=(y-_y)/steps,dz=(zoom-_z)/steps;
            let anim=()=>{ if(cur<steps){_x+=dx;_y+=dy;_z+=dz;updateView(_x,_y,_z);cur++;setTimeout(anim,12);}else{updateView(x,y,zoom);} };
            anim();
        }else{
            updateView(x,y,zoom);
        }
    }catch(e){}
}
// Expose for index.js usage or fallback
window.centerToZeroZero=()=>setMapViewToZeroZero(0);
</script>
</body>
</html>
